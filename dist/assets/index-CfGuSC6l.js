import{H as N,n as O}from"./navigator-C92a063l.js";import{u as H,r as $,a as I,s as z,y as J,c as U,d as a,b as v,w as r,e as n,F as h,l as K,P as Q,R as W,f as d,o as g,S as X,x as Y,O as b,i as q,q as T,E as f,H as w,T as Z,U as ee,V as oe}from"./index-3UtpE0ST.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"container"},ae={class:"content"},se={__name:"index",setup(ne){const k=H(),c=K();let o=$({title:null,typeId:null,price:null,description:null,goodsLocation:null,contactInfo:null,imageList:[]}),L=I([]);function E(t){const e=t.type==="image/jpeg"||"image/png",s=t.size/1024/1024<2;return e?s?!0:(f.error("图片不能超过2MB!"),!1):(f.error("只能上传jepg、png、jpg格式的图片！"),!1)}function B(t,e){console.log(t),console.log(e),f.error("最多只能上传5张图片！")}const m=I(),F=I(),P={title:[{required:!0,message:"请输入标题！",trigger:["blur"]}],imageList:[{required:!0,message:"请至少一张上传商品展示图",trigger:["blur"]}],typeId:[{required:!0,message:"请选择商品类别！",trigger:["blur"]}],price:[{required:!0,message:"请输入商品价格！",trigger:["blur"]},{required:!0,message:"请输入商品价格！",trigger:["blur"]}],contactInfo:[{required:!0,message:"请输入联系方式！",trigger:["blur"]}]};let p=[];function G(t,e){console.log(t),p=e,console.log(p)}async function V(t){let e=new FormData;c.query.goodsId&&(t=o.imageList),t.forEach(l=>{e.append("files",l.raw),console.log(l.raw)}),await w();let{detailPictureUrls:s}=await oe(e);return console.log(s),s}async function R(){var e,s;await((e=m.value)==null?void 0:e.validate()),await w();let t={title:o.title,typeId:o.typeId,price:o.price,description:o.description,goodsLocation:o.goodsLocation,contactInfo:o.contactInfo,sellerStuId:k.stuId,createTime:null,detailPictureUrls:[]};V(p).then(async l=>{t.detailPictureUrls=l,p.forEach(u=>{u.status="success"}),await Z(t)}).catch(l=>{p.forEach(u=>{u.status="fail"})}),f.success("上架成功！"),(s=m.value)==null||s.resetFields()}async function j(){let t=await Q(c.query.goodsId);o.goodsId=c.query.goodsId,o.title=t.goods.title,o.typeId=t.goods.typeId,o.price=t.goods.price,o.description=t.goods.description,o.goodsLocation=t.goods.goodsLocation,o.contactInfo=t.goods.contactInfo;let e=t.goods.detailPictureUrls;for(let s=0;s<e.length;s++)W.get(`http://localhost:8080/goods/urlToFile?url=${t.goods.detailPictureUrls[s]}`,{responseType:"blob"}).then(l=>{console.log(l);let u=new Blob([l.data]),y=URL.createObjectURL(u),_=new File([u],"image.png",{type:"image/png"});o.imageList.push({name:"iamge"+s+".png",raw:_,url:y,status:"ready"})}).catch(l=>{console.log("fail")})}async function A(){var e;await((e=m.value)==null?void 0:e.validate()),await w();let t={goodsId:c.query.goodsId,title:o.title,typeId:o.typeId,price:o.price,description:o.description,goodsLocation:o.goodsLocation,contactInfo:o.contactInfo,detailPictureUrls:[]};V(p).then(async s=>{t.detailPictureUrls=s,p.forEach(l=>{l.status="success"}),await ee(t)})}return z(async()=>{let t=await J();console.log("goodsTypes.value");let e=t.goodsTypes[10];t.goodsTypes.splice(10,1),t.goodsTypes.push(e),L.value=t.goodsTypes,c.query.goodsId?j():console.log("nogoodsId")}),(t,e)=>{const s=d("el-input"),l=d("el-form-item"),u=d("el-icon"),y=d("el-upload"),_=d("el-option"),C=d("el-select"),M=d("el-input-number"),x=d("el-button"),S=d("el-form");return g(),U(h,null,[a(N),v("div",le,[a(O),v("div",ae,[a(S,{"label-width":"auto",model:n(o),rules:P,ref_key:"ruleFormRef",ref:m},{default:r(()=>[a(l,{label:"标题：",prop:"title",style:{width:"700px"}},{default:r(()=>[a(s,{modelValue:n(o).title,"onUpdate:modelValue":e[0]||(e[0]=i=>n(o).title=i),type:"text",clearable:"",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(l,{label:"商品展示图：",prop:"imageList"},{default:r(()=>[a(y,{ref_key:"uploadRef",ref:F,"file-list":n(o).imageList,"onUpdate:fileList":e[1]||(e[1]=i=>n(o).imageList=i),"list-type":"picture-card",limit:5,"auto-upload":!1,"before-upload":E,"on-exceed":B,"on-change":G,multiple:""},{default:r(()=>[a(u,null,{default:r(()=>[a(n(X))]),_:1})]),_:1},8,["file-list"])]),_:1}),a(l,{label:"类别：",prop:"typeId"},{default:r(()=>[a(C,{modelValue:n(o).typeId,"onUpdate:modelValue":e[2]||(e[2]=i=>n(o).typeId=i),palceholder:"请选择商品类别"},{default:r(()=>[(g(!0),U(h,null,Y(n(L),(i,D)=>(g(),b(_,{key:D,label:i.type,value:i.typeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"价格（元）：",prop:"price"},{default:r(()=>[a(M,{modelValue:n(o).price,"onUpdate:modelValue":e[3]||(e[3]=i=>n(o).price=i),type:"text",precision:2},null,8,["modelValue"])]),_:1}),a(l,{label:"交易地点：",prop:"goodsLocation"},{default:r(()=>[a(s,{modelValue:n(o).goodsLocation,"onUpdate:modelValue":e[4]||(e[4]=i=>n(o).goodsLocation=i),type:"text",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(l,{label:"联系方式：",prop:"contactInfo"},{default:r(()=>[a(s,{modelValue:n(o).contactInfo,"onUpdate:modelValue":e[5]||(e[5]=i=>n(o).contactInfo=i),type:"text",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(l,{label:"商品描述：",prop:"description"},{default:r(()=>[a(s,{modelValue:n(o).description,"onUpdate:modelValue":e[6]||(e[6]=i=>n(o).description=i),type:"textarea",clearable:"",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(l,null,{default:r(()=>[n(c).query.goodsId?T("",!0):(g(),b(x,{key:0,class:"elButton",type:"primary",onClick:e[7]||(e[7]=i=>R())},{default:r(()=>[q("上架")]),_:1})),n(c).query.goodsId?(g(),b(x,{key:1,class:"elButton",type:"primary",onClick:e[8]||(e[8]=i=>A())},{default:r(()=>[q("确认修改")]),_:1})):T("",!0)]),_:1})]),_:1},8,["model"])])])],64)}}},ue=te(se,[["__scopeId","data-v-f239d143"]]);export{ue as default};
